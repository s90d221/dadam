<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head xmlns:th="http://www.thymeleaf.org">
    <meta charset="UTF-8" />
    <title>다담 · 가족 대화/약속 플랫폼</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Base & layout & components & widgets -->
    <link rel="stylesheet" th:href="@{/css/familyhub.base.css}" />
    <link rel="stylesheet" th:href="@{/css/familyhub.layout.css}" />
    <link rel="stylesheet" th:href="@{/css/familyhub.components.css}" />
    <link rel="stylesheet" th:href="@{/css/familyhub.widgets.css}" />
</head>
<body class="fh-body theme-light">
<div class="app">

    <!-- ================= HEADER ================= -->
    <header class="header">
        <div class="header-left">
            <button class="logo-chip" type="button">
                <span class="logo-mark">茶</span>
                <div class="logo-text">
                    <span class="logo-title">다담</span>
                    <span class="logo-subtitle">우리 가족 대화 앨범</span>
                </div>
            </button>

            <nav class="main-nav" aria-label="다담 주요 메뉴">
                <button class="nav-pill is-active" data-view="home" type="button">
                    오늘의 질문
                </button>
                <button class="nav-pill" data-view="calendar" type="button">
                    가족 일정
                </button>
                <button class="nav-pill" data-view="games" type="button">
                    밸런스 · 신조어
                </button>
                <button class="nav-pill" data-view="archive" type="button">
                    지난 다담
                </button>
            </nav>
        </div>

        <div class="header-right">
            <!-- 알림 열기 -->
            <button class="header-icon-btn" id="open-notifications" type="button" aria-label="알림 열기">
                <span class="fh-icon-bell"></span>
                <span class="badge-dot" id="notification-badge"></span>
            </button>

            <!-- 로그인/회원 관리 -->
            <button class="header-icon-btn" id="open-auth" type="button" aria-label="로그인/회원 관리">
                <span class="fh-icon-user"></span>
            </button>

            <!-- 프로필 / 마이페이지 -->
            <button class="avatar-chip" id="open-profile" type="button">
                <span class="avatar avatar-sm" id="current-avatar">
                    <span class="avatar-initial">가</span>
                </span>
                <span class="avatar-name" id="current-username">우리 가족</span>
                <span class="fh-icon-chevron-down"></span>
            </button>
        </div>
    </header>

    <!-- ================= MAIN LAYOUT ================= -->
    <main class="main-layout">
        <!-- ====== MAIN COLUMN ====== -->
        <section class="main-column">

            <!-- 오늘의 질문 / 답변 입력 -->
            <section class="card card-hero" aria-labelledby="today-question-title">
                <header class="card-header">
                    <div class="card-header-left">
                        <span class="pill pill-soft">오늘의 질문</span>
                        <div class="card-title-wrap">
                            <h1 class="card-title" id="today-question-title">
                                오늘 가족에게 던지는 한 가지 질문
                            </h1>
                            <p class="card-subtitle">
                                모두가 한 번씩 답하면, 내일 새로운 질문이 열려요 ✨
                            </p>
                        </div>
                    </div>
                    <div class="card-header-right">
                        <div class="date-badge">
                            <span id="today-label">2025년 11월 18일</span>
                        </div>
                        <button class="ghost-icon-btn" id="open-question-archive" type="button">
                            <span class="fh-icon-calendar"></span>
                            <span>질문 선택</span>
                        </button>
                    </div>
                </header>

                <div class="question-main">
                    <div class="question-text-wrap">
                        <p class="question-tagline">
                            오늘의 다담 주제
                        </p>

                        <!-- ✅ 질문 ID를 data-question-id로 바인딩 -->
                        <p
                                class="question-text"
                                id="today-question-text"
                                data-question-id=""
                                th:attr="data-question-id=${todayQuestion != null} ? ${todayQuestion.id} : null"
                                th:text="${todayQuestion != null} ? ${todayQuestion.content} : '가족과 함께한 여행 중 가장 기억에 남는 순간은 언제였나요?'"
                        >
                            가족과 함께한 여행 중 가장 기억에 남는 순간은 언제였나요?
                        </p>

                        <div class="question-meta">
                            <span class="chip chip-soft">
                                <span class="fh-icon-heart-small"></span>
                                <span id="question-like-count">12</span>명이 좋아했어요
                            </span>
                            <span class="chip chip-outline">
                                모든 가족 답변 완료 시 다음 질문이 열립니다
                            </span>
                        </div>
                    </div>

                    <form class="answer-form" id="answer-form">
                        <label class="field-label" for="answer-input">
                            내 답변 적어보기
                        </label>
                        <div class="textarea-shell">
                            <textarea
                                    id="answer-input"
                                    class="textarea"
                                    rows="3"
                                    placeholder="오늘 있었던 일이나 떠오르는 기억을 편하게 적어 주세요 :)"
                            ></textarea>
                            <div class="textarea-footer">
                                <div class="emoji-row">
                                    <button type="button" class="emoji-chip" data-emoji="😊">😊</button>
                                    <button type="button" class="emoji-chip" data-emoji="🥰">🥰</button>
                                    <button type="button" class="emoji-chip" data-emoji="🤣">🤣</button>
                                    <button type="button" class="emoji-chip" data-emoji="😢">😢</button>
                                </div>
                                <div class="answer-actions">
                                    <span class="length-hint" id="answer-length-hint">0 / 500</span>
                                    <button class="btn btn-primary" type="submit">
                                        답변 올리기
                                    </button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </section>

            <!-- 가족 답변 리스트 -->
            <section class="card card-answers" aria-label="가족 답변">
                <header class="card-header">
                    <div class="card-header-left">
                        <h2 class="card-title">우리 가족 답변</h2>
                        <p class="card-subtitle">
                            클릭하면 각자 답변에 댓글을 달 수 있어요.
                        </p>
                    </div>
                    <div class="card-header-right">
                        <span class="pill pill-soft" id="answer-progress-pill">
                            0 / 0명 참여 중
                        </span>
                    </div>
                </header>

                <!-- ✅ 실제 데이터는 dadam.answers.js가 렌더링 -->
                <ul class="answer-list" id="answer-list"></ul>
            </section>

            <!-- 밸런스 게임 + 신조어 퀴즈 영역 -->
            <section class="cards-row">
                <!-- 밸런스 게임 -->
                <section class="card card-balance" aria-label="오늘의 밸런스 게임">
                    <header class="card-header">
                        <div class="card-header-left">
                            <h2 class="card-title">오늘의 밸런스 게임</h2>
                            <p class="card-subtitle">
                                가족 선택이 어디에 더 많이 모일까요?
                            </p>
                        </div>
                        <button class="ghost-icon-btn" id="regen-balance" type="button">
                            <span class="fh-icon-refresh"></span>
                            <span>다른 주제</span>
                        </button>
                    </header>

                    <div class="balance-body" id="balance-game" data-game-id="">
                        <p class="balance-question" id="balance-question">
                            평생 한 가지 음식만 먹어야 한다면?
                        </p>

                        <div class="balance-options">
                            <button
                                    class="balance-option"
                                    type="button"
                                    data-choice="A"
                            >
                                <div class="balance-label">A</div>
                                <p class="balance-text">라면 🍜</p>
                                <div class="balance-result">
                                    <div class="balance-bar" data-bar="A"></div>
                                    <span class="balance-percent" data-percent="A">0%</span>
                                </div>
                                <div class="balance-avatars" data-avatars="A"></div>
                            </button>

                            <button
                                    class="balance-option"
                                    type="button"
                                    data-choice="B"
                            >
                                <div class="balance-label">B</div>
                                <p class="balance-text">치킨 🍗</p>
                                <div class="balance-result">
                                    <div class="balance-bar" data-bar="B"></div>
                                    <span class="balance-percent" data-percent="B">0%</span>
                                </div>
                                <div class="balance-avatars" data-avatars="B"></div>
                            </button>
                        </div>
                    </div>
                </section>

                <!-- 신조어 퀴즈 -->
                <section class="card card-quiz" aria-label="부모 세대를 위한 신조어 퀴즈">
                    <header class="card-header">
                        <div class="card-header-left">
                            <h2 class="card-title">부모 세대를 위한 신조어 퀴즈</h2>
                            <p class="card-subtitle">
                                아이들 세대 말, 얼마나 알고 있을까요?
                            </p>
                        </div>
                        <button class="ghost-icon-btn" id="regen-quiz" type="button">
                            <span class="fh-icon-refresh"></span>
                            <span>다른 문제</span>
                        </button>
                    </header>

                    <div class="quiz-body" id="slang-quiz" data-quiz-id="">
                        <p class="quiz-question" id="quiz-question">
                            “알잘딱깔센”의 뜻은 무엇일까요?
                        </p>
                        <ul class="quiz-options" id="quiz-options">
                            <!-- JS에서 실제 보기 렌더링 -->
                        </ul>
                        <p class="quiz-feedback" id="quiz-feedback" aria-live="polite"></p>
                    </div>
                </section>
            </section>
        </section>

        <!-- ====== SIDEBAR ====== -->
        <aside class="sidebar" aria-label="가족 정보 및 일정 사이드바">

            <!-- 가족 멤버 / 초대 -->
            <section class="card card-family">
                <header class="card-header">
                    <div class="card-header-left">
                        <h2 class="card-title">우리 가족</h2>
                        <p class="card-subtitle">
                            프로필을 꾸미고, 가족을 초대해 보세요.
                        </p>
                    </div>
                    <button class="btn btn-ghost" id="open-invite" type="button">
                        초대 코드
                    </button>
                </header>

                <div class="family-grid" id="family-grid">
                    <button class="family-cell" type="button" data-user-id="mom">
                        <span class="avatar avatar-md">
                            <span class="avatar-initial">엄</span>
                        </span>
                        <span class="family-name">엄마</span>
                        <span class="family-role-badge">Parent</span>
                    </button>

                    <button class="family-cell" type="button" data-user-id="dad">
                        <span class="avatar avatar-md">
                            <span class="avatar-initial">아</span>
                        </span>
                        <span class="family-name">아빠</span>
                        <span class="family-role-badge">Parent</span>
                    </button>

                    <button class="family-cell" type="button" data-user-id="me">
                        <span class="avatar avatar-md avatar-accent">
                            <span class="avatar-initial">나</span>
                        </span>
                        <span class="family-name">나</span>
                        <span class="family-role-badge">Me</span>
                    </button>

                    <button class="family-cell family-add" id="family-add-btn" type="button">
                        <span class="avatar avatar-md avatar-dashed">
                            <span class="fh-icon-plus"></span>
                        </span>
                        <span class="family-name">멤버 추가</span>
                    </button>
                </div>

                <p class="family-hint">
                    이미 초대 코드를 받은 가족은 로그인 후 입력만 하면 바로 합류할 수 있어요.
                </p>
            </section>

            <!-- 캘린더 + 일정 -->
            <section class="card card-calendar">
                <header class="card-header">
                    <div class="card-header-left">
                        <h2 class="card-title">11월 가족 캘린더</h2>
                        <p class="card-subtitle">
                            같이 밥 먹는 날, 여행, 기념일을 한눈에.
                        </p>
                    </div>
                    <button class="btn btn-primary btn-sm" id="open-schedule-modal" type="button">
                        약속 만들기
                    </button>
                </header>

                <div class="calendar-shell">
                    <div class="calendar-header">
                        <button class="ghost-icon-btn" id="calendar-prev" type="button" aria-label="이전 달">
                            <span class="fh-icon-chevron-left"></span>
                        </button>
                        <div class="calendar-title" id="calendar-title">2025년 11월</div>
                        <button class="ghost-icon-btn" id="calendar-next" type="button" aria-label="다음 달">
                            <span class="fh-icon-chevron-right"></span>
                        </button>
                    </div>
                    <div class="calendar-grid" id="calendar-grid">
                        <!-- dadam.ui.js에서 달력 렌더링 -->
                    </div>
                </div>

                <!-- ✅ 일정 리스트: JS가 API 결과로 렌더 -->
                <div class="event-list" id="event-list"></div>
            </section>

            <!-- 최근 활동 / 알림 미리보기 -->
            <section class="card card-activity">
                <header class="card-header">
                    <div class="card-header-left">
                        <h2 class="card-title">최근 활동</h2>
                        <p class="card-subtitle">
                            누가 답변을 올리고, 댓글을 남겼는지 확인해요.
                        </p>
                    </div>
                    <button class="ghost-icon-btn" id="open-notifications-from-card" type="button">
                        <span>전체 보기</span>
                        <span class="fh-icon-chevron-right"></span>
                    </button>
                </header>

                <ul class="activity-list" id="activity-list">
                    <!-- 필요하면 나중에 실제 데이터로 교체 -->
                    <li class="activity-item">
                        <span class="activity-icon activity-type-answer"></span>
                        <div class="activity-text">
                            <p class="activity-title">엄마가 오늘의 질문에 답변을 남겼어요.</p>
                            <p class="activity-meta">3분 전</p>
                        </div>
                    </li>
                </ul>
            </section>
        </aside>
    </main>
</div>

<!-- ================= MODALS ================= -->

<!-- 🔔 알림 모달 -->
<div id="modal-notifications" class="modal-backdrop">
    <div class="modal">
        <header class="modal-header">
            <h2 class="modal-title">알림</h2>
            <button class="ghost-icon-btn" type="button" data-close-modal="modal-notifications">
                <span class="fh-icon-close"></span>
            </button>
        </header>
        <div class="modal-body">
            <ul class="notification-list" id="notification-list">
                <!-- dadam.core.js 에서 렌더링 -->
            </ul>
        </div>
    </div>
</div>

<!-- 👤 프로필 / 마이페이지 모달 -->
<div id="modal-profile" class="modal-backdrop">
    <div class="modal">
        <header class="modal-header">
            <h2 class="modal-title">프로필 설정</h2>
            <button class="ghost-icon-btn" type="button" data-close-modal="modal-profile">
                <span class="fh-icon-close"></span>
            </button>
        </header>
        <div class="modal-body">
            <form id="profile-form">
                <div class="profile-avatar-section">
                    <div class="avatar avatar-lg avatar-soft" id="profile-avatar-preview">
                        <span class="avatar-initial">나</span>
                    </div>
                    <label class="btn btn-ghost btn-sm">
                        이미지 선택
                        <input id="profile-image-input" type="file" accept="image/*" hidden />
                    </label>
                </div>

                <div class="field-group">
                    <label class="field-label" for="profile-name-input">이름</label>
                    <input id="profile-name-input" class="input" type="text" placeholder="이름을 입력하세요" />
                </div>

                <div class="field-group">
                    <label class="field-label" for="profile-role-input">역할</label>
                    <select id="profile-role-input" class="select">
                        <option value="child">자녀</option>
                        <option value="parent">부모</option>
                        <option value="grandparent">조부모</option>
                    </select>
                </div>

                <div class="modal-footer">
                    <button class="btn btn-ghost" type="button" data-close-modal="modal-profile">취소</button>
                    <button class="btn btn-primary" type="submit">저장</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- 🔐 로그인 / 회원가입 모달 -->
<div id="modal-auth" class="modal-backdrop">
    <div class="modal">
        <header class="modal-header">
            <h2 class="modal-title">로그인 / 회원가입</h2>
            <button class="ghost-icon-btn" type="button" data-close-modal="modal-auth">
                <span class="fh-icon-close"></span>
            </button>
        </header>

        <div class="modal-body">
            <!-- 탭 -->
            <div class="auth-tabs">
                <button class="auth-tab is-active" type="button" data-auth-tab="login">로그인</button>
                <button class="auth-tab" type="button" data-auth-tab="signup">회원가입</button>
            </div>

            <!-- 로그인 패널 -->
            <section class="auth-panel is-active" data-auth-panel="login">
                <form id="login-form">
                    <div class="field-group">
                        <label class="field-label" for="login-email">이메일</label>
                        <input id="login-email" class="input" type="email" name="email" required />
                    </div>
                    <div class="field-group">
                        <label class="field-label" for="login-password">비밀번호</label>
                        <input id="login-password" class="input" type="password" name="password" required />
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-ghost" type="button" data-close-modal="modal-auth">취소</button>
                        <button class="btn btn-primary" type="submit">로그인</button>
                    </div>
                </form>
            </section>

            <!-- 회원가입 패널 -->
            <section class="auth-panel" data-auth-panel="signup">
                <form id="signup-form">
                    <div class="field-group">
                        <label class="field-label" for="signup-name">이름</label>
                        <input id="signup-name" class="input" type="text" name="name" required />
                    </div>
                    <div class="field-group">
                        <label class="field-label" for="signup-email">이메일</label>
                        <input id="signup-email" class="input" type="email" name="email" required />
                    </div>
                    <div class="field-group">
                        <label class="field-label" for="signup-password">비밀번호</label>
                        <input id="signup-password" class="input" type="password" name="password" required />
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-ghost" type="button" data-close-modal="modal-auth">취소</button>
                        <button class="btn btn-primary" type="submit">회원가입</button>
                    </div>
                </form>
            </section>
        </div>
    </div>
</div>

<!-- 📅 약속 만들기 모달 -->
<div id="modal-schedule" class="modal-backdrop">
    <div class="modal">
        <header class="modal-header">
            <h2 class="modal-title">가족 약속 만들기</h2>
            <button class="ghost-icon-btn" type="button" data-close-modal="modal-schedule">
                <span class="fh-icon-close"></span>
            </button>
        </header>

        <div class="modal-body">
            <form id="schedule-form">
                <div class="field-group">
                    <label class="field-label" for="schedule-title">약속 이름</label>
                    <input id="schedule-title" class="input" type="text" placeholder="예: 토요일 가족 외식" required />
                </div>

                <div class="field-group field-row">
                    <div class="field-col">
                        <label class="field-label" for="schedule-date">날짜</label>
                        <input id="schedule-date" class="input" type="date" required />
                    </div>
                    <div class="field-col">
                        <label class="field-label" for="schedule-time">시간</label>
                        <input id="schedule-time" class="input" type="time" />
                    </div>
                </div>

                <div class="field-group">
                    <label class="field-label" for="schedule-place">장소</label>
                    <input id="schedule-place" class="input" type="text" placeholder="예: 집 앞 식당" />
                </div>

                <div class="field-group">
                    <label class="field-label" for="schedule-memo">메모</label>
                    <textarea id="schedule-memo" class="textarea" rows="3" placeholder="약속에 대한 추가 메모를 적어 주세요."></textarea>
                </div>

                <div class="field-group">
                    <label class="checkbox">
                        <input id="schedule-remind" type="checkbox" checked />
                        <span>약속 전에 알림 받기</span>
                    </label>
                </div>

                <div class="modal-footer">
                    <button class="btn btn-ghost" type="button" data-close-modal="modal-schedule">취소</button>
                    <button class="btn btn-primary" type="submit">등록</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- ✅ 답변 상세 + 댓글 모달 (answers.js에서 사용) -->
<div id="modal-answer-thread" class="modal-backdrop">
    <div class="modal">
        <header class="modal-header">
            <h2 class="modal-title">가족 답변</h2>
            <button class="ghost-icon-btn" type="button" data-close-modal="modal-answer-thread">
                <span class="fh-icon-close"></span>
            </button>
        </header>
        <div class="modal-body">
            <div id="answer-thread-main"></div>
            <hr />
            <ul class="comment-list" id="comment-list"></ul>

            <form id="comment-form" class="comment-form">
                <div class="field-group">
                    <label class="field-label" for="comment-input">댓글 남기기</label>
                    <textarea id="comment-input" class="textarea" rows="2" placeholder="가족에게 따뜻한 한 마디를 남겨 보세요."></textarea>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-primary" type="submit">댓글 등록</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- ================= SCRIPTS ================= -->
<script th:src="@{/js/dadam.core.js}"></script>
<script th:src="@{/js/dadam.profiles-games.js}"></script>
<script th:src="@{/js/dadam.answers.js}"></script>
<script th:src="@{/js/dadam.ui.js}"></script>

</body>
</html>
